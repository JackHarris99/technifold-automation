schema_name,view_name,view_definition,is_updatable,is_insertable_into
public,catalog_products," SELECT product_code,
    description,
    category
   FROM products;",YES,YES
public,company_consumables_view," SELECT company_id,
    product_code AS consumable_code,
    first_purchased_at AS first_ordered_at,
    last_purchased_at AS last_ordered_at,
    total_purchases AS total_orders,
    total_quantity
   FROM company_product_history
  WHERE (product_type = 'consumable'::text);",YES,YES
public,company_tools_view," SELECT company_id,
    product_code AS tool_code,
    first_purchased_at AS first_seen_at,
    last_purchased_at AS last_seen_at,
    total_quantity AS total_units
   FROM company_product_history
  WHERE (product_type = 'tool'::text);",YES,YES
public,v_active_subscription_tools," SELECT st.subscription_id,
    st.tool_code,
    st.added_at,
    st.added_by,
    s.company_id,
    s.contact_id,
    s.status AS subscription_status,
    p.description AS tool_name,
    p.rental_price_monthly AS tool_rental_price
   FROM ((subscription_tools st
     JOIN subscriptions s ON ((st.subscription_id = s.subscription_id)))
     JOIN products p ON ((st.tool_code = p.product_code)))
  WHERE (st.removed_at IS NULL);",NO,NO
public,v_active_subscriptions," SELECT s.subscription_id,
    s.stripe_subscription_id,
    s.company_id,
    c.company_name,
    s.contact_id,
    ct.full_name AS contact_name,
    ct.email AS contact_email,
    s.monthly_price,
    s.currency,
    s.tools,
    s.status,
    s.trial_end_date,
    s.next_billing_date,
    s.ratchet_max,
    s.created_at,
        CASE
            WHEN (((s.status)::text = 'trial'::text) AND (s.trial_end_date > now())) THEN (EXTRACT(day FROM ((s.trial_end_date)::timestamp with time zone - now())))::integer
            ELSE 0
        END AS trial_days_remaining,
    jsonb_array_length(s.tools) AS tool_count
   FROM ((subscriptions s
     JOIN companies c ON ((s.company_id = c.company_id)))
     LEFT JOIN contacts ct ON ((s.contact_id = ct.contact_id)))
  WHERE ((s.status)::text = ANY ((ARRAY['trial'::character varying, 'active'::character varying])::text[]))
  ORDER BY s.created_at DESC;",NO,NO
